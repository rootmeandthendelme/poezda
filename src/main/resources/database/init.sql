--
-- PostgreSQL database dump
--

-- Dumped from database version 16.3 (Debian 16.3-1.pgdg110+1)
-- Dumped by pg_dump version 16.3 (Debian 16.3-1.pgdg110+1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: seat_availability(); Type: FUNCTION; Schema: public; Owner: intuser
--

CREATE FUNCTION public.seat_availability() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
	new_trip_id integer = 0;
	new_departure_time time;
	new_arrival_time time;
	available_seat_id integer = -1;
BEGIN
	SELECT trip_point.trip_id INTO new_trip_id FROM trip_point WHERE trip_point.id=NEW.startpoint_id;
	SELECT trip_point.arrival_time INTO new_departure_time FROM trip_point WHERE trip_point.id=NEW.startpoint_id;
	SELECT trip_point.arrival_time INTO new_arrival_time FROM trip_point WHERE trip_point.id=NEW.endpoint_id;

	SELECT seat.id INTO available_seat_id FROM seat
          WHERE seat.id=NEW.seat_id AND seat.id NOT IN(
                	SELECT seat.id FROM reservation
                	JOIN trip_point start_time ON start_time.id=reservation.startpoint_id AND start_time.trip_id=new_trip_id
                	JOIN trip_point end_time ON end_time.id=reservation.endpoint_id AND end_time.trip_id=new_trip_id
                	JOIN seat ON seat.id=reservation.seat_id
               		WHERE(((end_time.arrival_time>=new_departure_time AND end_time.arrival_time<=new_arrival_time)
                	OR ((start_time.arrival_time>=new_departure_time AND start_time.arrival_time<=new_arrival_time))
                	OR ((start_time.arrival_time<=new_departure_time AND end_time.arrival_time>=new_arrival_time))))
		  );

	IF NOT FOUND THEN
		raise exception 'seat % is not available', NEW.seat_id;
	ELSE
		RETURN NEW;
	END IF;
END;
$$;


ALTER FUNCTION public.seat_availability() OWNER TO intuser;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: carriege; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.carriege (
    id integer NOT NULL,
    carriege_number integer NOT NULL,
    train_id integer NOT NULL,
    carriege_type_id integer NOT NULL
);


ALTER TABLE public.carriege OWNER TO intuser;

--
-- Name: Carriege_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.carriege ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Carriege_id_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: train_type; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.train_type (
    id integer NOT NULL,
    type character varying(25) NOT NULL
);


ALTER TABLE public.train_type OWNER TO intuser;

--
-- Name: TrainType_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.train_type ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."TrainType_id_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: train; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.train (
    id integer NOT NULL,
    name character varying(25) NOT NULL,
    train_type_id integer NOT NULL
);


ALTER TABLE public.train OWNER TO intuser;

--
-- Name: Train_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.train ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Train_id_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: carriege_type; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.carriege_type (
    id integer NOT NULL,
    type character varying(10) NOT NULL
);


ALTER TABLE public.carriege_type OWNER TO intuser;

--
-- Name: carriege_type_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.carriege_type ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.carriege_type_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: comfort; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.comfort (
    id integer NOT NULL,
    value character varying(25) NOT NULL
);


ALTER TABLE public.comfort OWNER TO intuser;

--
-- Name: comfort_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.comfort ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.comfort_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: locality; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.locality (
    id integer NOT NULL,
    name character varying(25) NOT NULL
);


ALTER TABLE public.locality OWNER TO intuser;

--
-- Name: locality_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.locality ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.locality_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: users; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.users (
    id integer NOT NULL,
    full_name character varying(128) NOT NULL,
    login character varying(10) NOT NULL,
    password character varying(60) NOT NULL,
    role character varying(20) NOT NULL
);


ALTER TABLE public.users OWNER TO intuser;

--
-- Name: passenger_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.users ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.passenger_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: platform; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.platform (
    id integer NOT NULL,
    num integer NOT NULL,
    station_id integer NOT NULL
);


ALTER TABLE public.platform OWNER TO intuser;

--
-- Name: platform_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.platform ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.platform_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: reservation; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.reservation (
    id integer NOT NULL,
    seat_id integer NOT NULL,
    user_id integer NOT NULL,
    startpoint_id integer NOT NULL,
    endpoint_id integer NOT NULL,
    passport character varying(10) NOT NULL,
    full_name character varying(128) NOT NULL
);


ALTER TABLE public.reservation OWNER TO intuser;

--
-- Name: reservation_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.reservation ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.reservation_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: seat; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.seat (
    id integer NOT NULL,
    seat_number integer NOT NULL,
    carriege_id integer NOT NULL
);


ALTER TABLE public.seat OWNER TO intuser;

--
-- Name: seat_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.seat ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.seat_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: station; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.station (
    id integer NOT NULL,
    name character varying(25),
    locality_id integer NOT NULL
);


ALTER TABLE public.station OWNER TO intuser;

--
-- Name: station_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.station ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.station_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: train_comfort; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.train_comfort (
    id integer NOT NULL,
    train_id integer NOT NULL,
    comfort_id integer NOT NULL
);


ALTER TABLE public.train_comfort OWNER TO intuser;

--
-- Name: train_comfort_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.train_comfort ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.train_comfort_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: trip; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.trip (
    id integer NOT NULL,
    travel_date date NOT NULL,
    train_id integer NOT NULL
);


ALTER TABLE public.trip OWNER TO intuser;

--
-- Name: trip_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.trip ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.trip_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: trip_point; Type: TABLE; Schema: public; Owner: intuser
--

CREATE TABLE public.trip_point (
    id integer NOT NULL,
    arrival_time time without time zone NOT NULL,
    departure_time time without time zone NOT NULL,
    trip_id integer NOT NULL,
    platform_id integer NOT NULL
);


ALTER TABLE public.trip_point OWNER TO intuser;

--
-- Name: trip_point_id_seq; Type: SEQUENCE; Schema: public; Owner: intuser
--

ALTER TABLE public.trip_point ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public.trip_point_id_seq
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Data for Name: carriege; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.carriege (id, carriege_number, train_id, carriege_type_id) FROM stdin;
11	2	4	2
10	1	4	1
9	3	3	1
8	2	3	1
7	1	3	1
6	3	2	3
5	2	2	2
4	1	2	1
3	3	1	1
2	2	1	1
1	1	1	1
12	3	4	3
14	2	5	1
13	1	5	1
\.


--
-- Data for Name: carriege_type; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.carriege_type (id, type) FROM stdin;
3	Плацкарт
2	Купе
1	СВ
\.


--
-- Data for Name: comfort; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.comfort (id, value) FROM stdin;
1	Кондиционер
2	Wi-Fi
3	Питание
4	Биотуалет
\.


--
-- Data for Name: locality; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.locality (id, name) FROM stdin;
1	Москва
2	Санкт-Петербург
3	Липецк
4	Малая Вишера
5	Окуловка
6	Бологое-Московское
7	Вышний Волочек
8	Спирово
9	Лихославль
10	Тверь
11	Елец
12	Ефремов
13	Ожерелье
100	test
\.


--
-- Data for Name: platform; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.platform (id, num, station_id) FROM stdin;
1	1	1
2	2	1
3	1	2
4	2	2
5	1	3
6	2	3
7	1	4
8	2	4
9	1	5
10	2	5
11	1	6
12	2	6
13	1	7
14	2	7
15	1	8
16	2	8
17	1	9
18	2	9
19	1	10
20	2	10
21	1	11
22	2	11
23	1	12
24	2	12
25	1	13
26	2	13
\.


--
-- Data for Name: reservation; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.reservation (id, seat_id, user_id, startpoint_id, endpoint_id, passport, full_name) FROM stdin;
2	25	1	5	8	4223400099	Травка Михаил Павлович
3	26	1	9	12	4223400099	Травка Михаил Павлович
4	26	1	5	8	4223400099	Травка Михаил Павлович
54	25	1	9	12	12312	ivan ivanovich
\.


--
-- Data for Name: seat; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.seat (id, seat_number, carriege_id) FROM stdin;
24	2	12
23	1	12
22	2	11
21	1	11
20	2	10
19	1	10
18	2	9
17	1	9
16	2	8
15	1	8
14	2	7
13	1	7
12	2	6
11	1	6
10	2	5
9	1	5
8	2	4
7	1	4
6	2	3
5	1	3
4	2	2
3	1	2
2	2	1
1	1	1
26	1	14
25	1	13
\.


--
-- Data for Name: station; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.station (id, name, locality_id) FROM stdin;
1	Казанский вокзал	1
2	Балтийский вокзал	2
3	ЖД вокзал	3
4	ЖД вокзал	4
5	ЖД вокзал	5
6	ЖД вокзал	6
7	ЖД вокзал	7
8	ЖД вокзал	8
9	ЖД вокзал	9
10	ЖД вокзал	10
11	ЖД вокзал	11
12	ЖД вокзал	12
13	ЖД вокзал	13
\.


--
-- Data for Name: train; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.train (id, name, train_type_id) FROM stdin;
2	723Р	1
1	751A	2
3	755А	2
4	727А	6
5	Победа	1
\.


--
-- Data for Name: train_comfort; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.train_comfort (id, train_id, comfort_id) FROM stdin;
2	1	4
1	1	1
5	2	4
4	2	3
3	2	1
8	3	4
7	3	3
6	3	1
10	4	4
9	4	1
11	5	1
12	5	4
\.


--
-- Data for Name: train_type; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.train_type (id, type) FROM stdin;
2	Сапсан
3	Стриж
1	Ласточка ЭС1
4	Ласточка ЭС1П
5	Ласточка ЭС2Г
6	Ласточка ЭС2ГП
7	Ласточка ЭС104
8	Ласточка ЭС105
\.


--
-- Data for Name: trip; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.trip (id, travel_date, train_id) FROM stdin;
1	2024-07-16	5
2	2024-07-18	5
3	2024-07-20	5
\.


--
-- Data for Name: trip_point; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.trip_point (id, arrival_time, departure_time, trip_id, platform_id) FROM stdin;
2	12:11:00	12:30:00	1	21
3	16:11:00	16:20:00	1	25
8	18:11:00	18:25:00	2	1
7	16:11:00	16:20:00	2	25
6	12:11:00	12:30:00	2	21
5	11:11:00	11:20:00	2	5
12	18:11:00	18:25:00	3	1
11	16:11:00	16:20:00	3	25
10	12:11:00	12:30:00	3	21
9	11:11:00	11:20:00	3	5
4	18:11:00	18:25:00	1	1
1	11:11:00	11:20:00	1	5
\.


--
-- Data for Name: users; Type: TABLE DATA; Schema: public; Owner: intuser
--

COPY public.users (id, full_name, login, password, role) FROM stdin;
1	Михаил Павлович Травка	mt	$2a$10$gWTM1Voz4UuJHPZUyEov4OlhVZYqWgkjA47d2oalvMoL6De.OtW2C	ROLE_USER
\.


--
-- Name: Carriege_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public."Carriege_id_seq"', 1, false);


--
-- Name: TrainType_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public."TrainType_id_seq"', 1, false);


--
-- Name: Train_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public."Train_id_seq"', 1, false);


--
-- Name: carriege_type_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.carriege_type_id_seq', 1, false);


--
-- Name: comfort_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.comfort_id_seq', 1, false);


--
-- Name: locality_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.locality_id_seq', 1, false);


--
-- Name: passenger_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.passenger_id_seq', 1, false);


--
-- Name: platform_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.platform_id_seq', 1, false);


--
-- Name: reservation_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.reservation_id_seq', 54, true);


--
-- Name: seat_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.seat_id_seq', 1, false);


--
-- Name: station_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.station_id_seq', 1, false);


--
-- Name: train_comfort_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.train_comfort_id_seq', 1, false);


--
-- Name: trip_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.trip_id_seq', 1, false);


--
-- Name: trip_point_id_seq; Type: SEQUENCE SET; Schema: public; Owner: intuser
--

SELECT pg_catalog.setval('public.trip_point_id_seq', 1, false);


--
-- Name: carriege Carriege_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.carriege
    ADD CONSTRAINT "Carriege_pkey" PRIMARY KEY (id);


--
-- Name: train_type TrainType_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train_type
    ADD CONSTRAINT "TrainType_pkey" PRIMARY KEY (id);


--
-- Name: train Train_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train
    ADD CONSTRAINT "Train_pkey" PRIMARY KEY (id);


--
-- Name: carriege_type carriege_type_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.carriege_type
    ADD CONSTRAINT carriege_type_pkey PRIMARY KEY (id);


--
-- Name: comfort comfort_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.comfort
    ADD CONSTRAINT comfort_pkey PRIMARY KEY (id);


--
-- Name: locality locality_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.locality
    ADD CONSTRAINT locality_pkey PRIMARY KEY (id);


--
-- Name: users passenger_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.users
    ADD CONSTRAINT passenger_pkey PRIMARY KEY (id);


--
-- Name: platform platform_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.platform
    ADD CONSTRAINT platform_pkey PRIMARY KEY (id);


--
-- Name: reservation reservation_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.reservation
    ADD CONSTRAINT reservation_pkey PRIMARY KEY (id);


--
-- Name: seat seat_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.seat
    ADD CONSTRAINT seat_pkey PRIMARY KEY (id);


--
-- Name: station station_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.station
    ADD CONSTRAINT station_pkey PRIMARY KEY (id);


--
-- Name: train_comfort train_comfort_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train_comfort
    ADD CONSTRAINT train_comfort_pkey PRIMARY KEY (id);


--
-- Name: trip trip_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.trip
    ADD CONSTRAINT trip_pkey PRIMARY KEY (id);


--
-- Name: trip_point trip_point_pkey; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.trip_point
    ADD CONSTRAINT trip_point_pkey PRIMARY KEY (id);


--
-- Name: carriege uniq_num; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.carriege
    ADD CONSTRAINT uniq_num UNIQUE (carriege_number, id);


--
-- Name: comfort unique_comfort_value; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.comfort
    ADD CONSTRAINT unique_comfort_value UNIQUE (value);


--
-- Name: locality unique_locality_name; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.locality
    ADD CONSTRAINT unique_locality_name UNIQUE (name);


--
-- Name: train unique_name; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train
    ADD CONSTRAINT unique_name UNIQUE (name);


--
-- Name: platform unique_platform_number_by_station; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.platform
    ADD CONSTRAINT unique_platform_number_by_station UNIQUE (station_id, num);


--
-- Name: seat unique_seat_number; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.seat
    ADD CONSTRAINT unique_seat_number UNIQUE (seat_number, id);


--
-- Name: station unique_station_name_by_locality; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.station
    ADD CONSTRAINT unique_station_name_by_locality UNIQUE (locality_id, name);


--
-- Name: train_type unique_type; Type: CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train_type
    ADD CONSTRAINT unique_type UNIQUE (type);


--
-- Name: reservation check_seat_availability; Type: TRIGGER; Schema: public; Owner: intuser
--

CREATE TRIGGER check_seat_availability BEFORE INSERT ON public.reservation FOR EACH ROW EXECUTE FUNCTION public.seat_availability();


--
-- Name: seat carriege_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.seat
    ADD CONSTRAINT carriege_id FOREIGN KEY (carriege_id) REFERENCES public.carriege(id) NOT VALID;


--
-- Name: carriege carriege_type_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.carriege
    ADD CONSTRAINT carriege_type_id FOREIGN KEY (carriege_type_id) REFERENCES public.carriege_type(id) NOT VALID;


--
-- Name: train_comfort comfort_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train_comfort
    ADD CONSTRAINT comfort_id FOREIGN KEY (comfort_id) REFERENCES public.comfort(id);


--
-- Name: reservation endpoint_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.reservation
    ADD CONSTRAINT endpoint_id FOREIGN KEY (endpoint_id) REFERENCES public.trip_point(id);


--
-- Name: station locality_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.station
    ADD CONSTRAINT locality_id FOREIGN KEY (locality_id) REFERENCES public.locality(id);


--
-- Name: trip_point platform_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.trip_point
    ADD CONSTRAINT platform_id FOREIGN KEY (platform_id) REFERENCES public.platform(id);


--
-- Name: reservation seat_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.reservation
    ADD CONSTRAINT seat_id FOREIGN KEY (seat_id) REFERENCES public.seat(id);


--
-- Name: reservation startpoint_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.reservation
    ADD CONSTRAINT startpoint_id FOREIGN KEY (startpoint_id) REFERENCES public.trip_point(id);


--
-- Name: platform station_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.platform
    ADD CONSTRAINT station_id FOREIGN KEY (station_id) REFERENCES public.station(id);


--
-- Name: carriege train_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.carriege
    ADD CONSTRAINT train_id FOREIGN KEY (train_id) REFERENCES public.train(id);


--
-- Name: train_comfort train_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train_comfort
    ADD CONSTRAINT train_id FOREIGN KEY (train_id) REFERENCES public.train(id);


--
-- Name: trip train_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.trip
    ADD CONSTRAINT train_id FOREIGN KEY (train_id) REFERENCES public.train(id);


--
-- Name: train train_type_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.train
    ADD CONSTRAINT train_type_id FOREIGN KEY (train_type_id) REFERENCES public.train_type(id) NOT VALID;


--
-- Name: trip_point trip_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.trip_point
    ADD CONSTRAINT trip_id FOREIGN KEY (trip_id) REFERENCES public.trip(id);


--
-- Name: reservation user_id; Type: FK CONSTRAINT; Schema: public; Owner: intuser
--

ALTER TABLE ONLY public.reservation
    ADD CONSTRAINT user_id FOREIGN KEY (user_id) REFERENCES public.users(id);


--
-- Name: SCHEMA public; Type: ACL; Schema: -; Owner: pg_database_owner
--

GRANT ALL ON SCHEMA public TO intuser;


--
-- PostgreSQL database dump complete
--
